var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function f(){return u(" ")}function d(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function p(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function g(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}let m;function y(t){m=t}const b=[],w=[],$=[],v=[],x=Promise.resolve();let k=!1;function _(t){$.push(t)}let E=!1;const S=new Set;function q(){if(!E){E=!0;do{for(let t=0;t<b.length;t+=1){const e=b[t];y(e),T(e.$$)}for(y(null),b.length=0;w.length;)w.pop()();for(let t=0;t<$.length;t+=1){const e=$[t];S.has(e)||(S.add(e),e())}$.length=0}while(b.length);for(;v.length;)v.pop()();k=!1,E=!1,S.clear()}}function T(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_)}}const z=new Set;function L(t,e){-1===t.$$.dirty[0]&&(b.push(t),k||(k=!0,x.then(q)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function O(i,s,l,a,u,f,d=[-1]){const h=m;y(i);const p=i.$$={fragment:null,ctx:null,props:f,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:s.context||[]),callbacks:n(),dirty:d,skip_bound:!1};let g=!1;if(p.ctx=l?l(i,s.props||{},((t,e,...n)=>{const r=n.length?n[0]:e;return p.ctx&&u(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),g&&L(i,t)),e})):[],p.update(),g=!0,r(p.before_update),p.fragment=!!a&&a(p.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);p.fragment&&p.fragment.l(t),t.forEach(c)}else p.fragment&&p.fragment.c();s.intro&&((b=i.$$.fragment)&&b.i&&(z.delete(b),b.i(w))),function(t,n,i,s){const{fragment:l,on_mount:c,on_destroy:a,after_update:u}=t.$$;l&&l.m(n,i),s||_((()=>{const n=c.map(e).filter(o);a?a.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(_)}(i,s.target,s.anchor,s.customElement),q()}var b,w;y(h)}function j(t,e,n){const r=t.slice();return r[14]=e[n],r}function N(t){let e;return{c(){e=a("div"),h(e,"class","ialert ierror svelte-1w6258q")},m(n,r){l(n,e,r),e.innerHTML=t[3]},p(t,n){8&n&&(e.innerHTML=t[3])},d(t){t&&c(e)}}}function H(t){let e,n;return{c(){e=a("div"),n=u(t[1]),h(e,"class","ialert isuccess svelte-1w6258q")},m(t,r){l(t,e,r),s(e,n)},p(t,e){2&e&&p(n,t[1])},d(t){t&&c(e)}}}function M(t){let e,n,r=t[2].nourl+"";return{c(){e=a("div"),n=u(r),h(e,"class","ialert iinfo svelte-1w6258q")},m(t,r){l(t,e,r),s(e,n)},p(t,e){4&e&&r!==(r=t[2].nourl+"")&&p(n,r)},d(t){t&&c(e)}}}function A(t){let e,n,i,m,y,b,w,$,v,x,k,_,E,S,q,T,z,L=t[14].title+"",O=t[14].name+"";return{c(){e=a("li"),n=a("div"),i=u(L),m=a("br"),y=f(),b=a("small"),w=a("i"),$=u(O),x=f(),k=a("div"),_=a("img"),q=f(),h(b,"class","svelte-1w6258q"),h(n,"class","run rleft svelte-1w6258q"),h(n,"title",v=t[2].run),_.src!==(E="images/right.png")&&h(_,"src","images/right.png"),h(_,"alt","Options"),g(_,"width","16px"),g(_,"height","24px"),h(k,"class","run svelte-1w6258q"),h(k,"title",S=t[2].runsilently),g(k,"display","flex"),g(k,"align-items","center"),g(k,"flex","0 0 32px"),g(e,"display","flex"),g(e,"justify-content","space-between")},m(r,c){l(r,e,c),s(e,n),s(n,i),s(n,m),s(n,y),s(n,b),s(b,w),s(w,$),s(e,x),s(e,k),s(k,_),s(e,q),T||(z=[d(n,"click",(function(){o(t[5](t[14],!0))&&t[5](t[14],!0).apply(this,arguments)})),d(k,"click",(function(){o(t[5](t[14],!1))&&t[5](t[14],!1).apply(this,arguments)}))],T=!0)},p(e,r){t=e,16&r&&L!==(L=t[14].title+"")&&p(i,L),16&r&&O!==(O=t[14].name+"")&&p($,O),4&r&&v!==(v=t[2].run)&&h(n,"title",v),4&r&&S!==(S=t[2].runsilently)&&h(k,"title",S)},d(t){t&&c(e),T=!1,r(z)}}}function C(e){let n,r,o,i,m,y,b,w,$,v,x,k,_,E,S,q,T,z,L,O,C=e[2].settings+"",P=e[2].help+"",R=e[3]&&N(e),B=e[1]&&H(e),U=!e[0]&&M(e),J=e[4],W=[];for(let t=0;t<J.length;t+=1)W[t]=A(j(e,J,t));return{c(){R&&R.c(),n=f(),B&&B.c(),r=f(),U&&U.c(),o=f(),i=a("ul");for(let t=0;t<W.length;t+=1)W[t].c();m=f(),y=a("div"),b=a("div"),w=a("img"),x=u(C),k=f(),_=a("a"),E=a("img"),T=u(P),w.src!==($="images/settings.png")&&h(w,"src","images/settings.png"),h(w,"alt",v=e[2].settings),g(w,"height","1.5rem"),g(w,"margin-right","0.5rem"),h(w,"class","svelte-1w6258q"),h(b,"class","menu svelte-1w6258q"),E.src!==(S="images/question-circle.png")&&h(E,"src","images/question-circle.png"),h(E,"alt",q=e[2].help),g(E,"height","1.5rem"),g(E,"margin-right","0.5rem"),h(E,"class","svelte-1w6258q"),h(_,"class","menu svelte-1w6258q"),h(_,"href",z=e[2].helplink),h(_,"target","_blank"),h(y,"class","elist svelte-1w6258q")},m(t,e){R&&R.m(t,e),l(t,n,e),B&&B.m(t,e),l(t,r,e),U&&U.m(t,e),l(t,o,e),l(t,i,e);for(let t=0;t<W.length;t+=1)W[t].m(i,null);l(t,m,e),l(t,y,e),s(y,b),s(b,w),s(b,x),s(y,k),s(y,_),s(_,E),s(_,T),L||(O=d(b,"click",I),L=!0)},p(t,[e]){if(t[3]?R?R.p(t,e):(R=N(t),R.c(),R.m(n.parentNode,n)):R&&(R.d(1),R=null),t[1]?B?B.p(t,e):(B=H(t),B.c(),B.m(r.parentNode,r)):B&&(B.d(1),B=null),t[0]?U&&(U.d(1),U=null):U?U.p(t,e):(U=M(t),U.c(),U.m(o.parentNode,o)),52&e){let n;for(J=t[4],n=0;n<J.length;n+=1){const r=j(t,J,n);W[n]?W[n].p(r,e):(W[n]=A(r),W[n].c(),W[n].m(i,null))}for(;n<W.length;n+=1)W[n].d(1);W.length=J.length}4&e&&v!==(v=t[2].settings)&&h(w,"alt",v),4&e&&C!==(C=t[2].settings+"")&&p(x,C),4&e&&q!==(q=t[2].help)&&h(E,"alt",q),4&e&&P!==(P=t[2].help+"")&&p(T,P),4&e&&z!==(z=t[2].helplink)&&h(_,"href",z)},i:t,o:t,d(t){R&&R.d(t),t&&c(n),B&&B.d(t),t&&c(r),U&&U.d(t),t&&c(o),t&&c(i),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(W,t),t&&c(m),t&&c(y),L=!1,O()}}}function P(){var t=document.documentElement.outerHTML;return chrome.runtime.sendMessage({action:"getSource",source:t}),t}function R(t){for(let e=0;e<t.length;e++){let n=t[e],r=document.getElementById(n.id);if(!r){let t=document.getElementsByName(n.id);t.length>0&&(r=t[0])}r&&(r.value=n.value)}}function I(){chrome.runtime.openOptionsPage()}function B(t,e,n){let r="",o="",i="",s=0,l="",c="",a="en",u={en:{errext:"Eonza is not available at <b>eonzaHost</b>. Try to <b><a href='eonzaHost'\n\t\t\t\tstyle='color:#fff;text-decoration:underline;' target='_blank'>open</a></b> it in the browser.",help:"Help",helplink:"https://www.eonza.org/docs/chrome-extension.html",nourl:"Specify Eonza URL in Settings",run:"Run and open the script in the browser",runok:"Script is successfully run",runsilently:"Run silently",save:"Save",settings:"Settings"},ru:{errext:"Eonza не доступна по адресу <b>eonzaHost</b>. Попробуйте <b><a href='eonzaHost'\n\t\t\t\tstyle='color:#fff;text-decoration:underline;' target='_blank'>открыть</a></b> её в браузере.",help:"Помощь",helplink:"https://www.eonza.org/ru/docs/chrome-extension.html",nourl:"Укажите Eonza URL в Настройках",run:"Запустить и открыть скрипт в браузере",runok:"Скрипт успешно запущен",runsilently:"Запустить скрытно",save:"Сохранить",settings:"Настройки"}},f=u.en,d="",h=[];async function p(t,e){try{const o=await fetch(`${r}/api/fillform`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskid:t})});let i=await o.json();i.error?n(3,d=i.error):(i.list&&chrome.scripting.executeScript({target:{tabId:s},function:R,args:[i.list]},(t=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError)})),!i.finished&&e<7&&setTimeout((()=>p(t,e+1)),1e3))}catch(t){n(3,d=t)}}return chrome.runtime.onMessage.addListener((function(t,e){if("getSource"==t.action)return t.source})),document.addEventListener("DOMContentLoaded",(async function(){a=(navigator.language||navigator.userLanguage).substr(0,2),"ru"==a&&n(2,f=u[a]);let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.scripting.executeScript({target:{tabId:t.id},function:P},(t=>{chrome.runtime.lastError||(l=t[0].result)})),s=t.id,i=t.url,c=t.title,chrome.storage.sync.get({eonzahost:""},(function(t){n(0,r=t.eonzahost),r&&("/"==r.charAt(r.length-1)&&n(0,r=r.substr(0,r.length-1)),async function(){try{const t=await fetch(`${r}/api/browserext`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:i})});let e=await t.json();n(4,h=e.list)}catch(t){n(3,d=f.errext.replaceAll("eonzaHost",encodeURI(r)))}}())}))})),[r,o,f,d,h,async function(t,e){n(3,d="");try{const s=await fetch(`${r}/api/browserrun`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,open:e,url:i,title:c,html:t.settings.html?l:""})});let a=await s.json();a.error?n(3,d=a.error):(n(1,o=f.runok),setTimeout((()=>{n(1,o=""),p(a.id,0)}),1e3),!r.startsWith("http://localhost")&&e&&setTimeout((()=>{let t=new URL(r);t.port=a.port,window.open(t.toString(),"_blank")}),1500))}catch(t){n(3,d=t)}}]}return new class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),O(this,t,B,C,i,{})}}({target:document.getElementById("app")})}();
