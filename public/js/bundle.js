var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function f(){return u(" ")}function p(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function d(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function h(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function g(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}let m;function y(t){m=t}const b=[],w=[],$=[],v=[],x=Promise.resolve();let _=!1;function k(t){$.push(t)}let E=!1;const q=new Set;function S(){if(!E){E=!0;do{for(let t=0;t<b.length;t+=1){const e=b[t];y(e),z(e.$$)}for(y(null),b.length=0;w.length;)w.pop()();for(let t=0;t<$.length;t+=1){const e=$[t];q.has(e)||(q.add(e),e())}$.length=0}while(b.length);for(;v.length;)v.pop()();_=!1,E=!1,q.clear()}}function z(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(k)}}const L=new Set;function T(t,e){-1===t.$$.dirty[0]&&(b.push(t),_||(_=!0,x.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function O(i,s,l,a,u,f,p=[-1]){const d=m;y(i);const h=i.$$={fragment:null,ctx:null,props:f,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:s.context||[]),callbacks:n(),dirty:p,skip_bound:!1};let g=!1;if(h.ctx=l?l(i,s.props||{},((t,e,...n)=>{const r=n.length?n[0]:e;return h.ctx&&u(h.ctx[t],h.ctx[t]=r)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](r),g&&T(i,t)),e})):[],h.update(),g=!0,r(h.before_update),h.fragment=!!a&&a(h.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);h.fragment&&h.fragment.l(t),t.forEach(c)}else h.fragment&&h.fragment.c();s.intro&&((b=i.$$.fragment)&&b.i&&(L.delete(b),b.i(w))),function(t,n,i,s){const{fragment:l,on_mount:c,on_destroy:a,after_update:u}=t.$$;l&&l.m(n,i),s||k((()=>{const n=c.map(e).filter(o);a?a.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(k)}(i,s.target,s.anchor,s.customElement),S()}var b,w;y(d)}function H(t,e,n){const r=t.slice();return r[12]=e[n],r}function j(t){let e;return{c(){e=a("div"),d(e,"class","ialert ierror svelte-1w6258q")},m(n,r){l(n,e,r),e.innerHTML=t[3]},p(t,n){8&n&&(e.innerHTML=t[3])},d(t){t&&c(e)}}}function N(t){let e,n;return{c(){e=a("div"),n=u(t[1]),d(e,"class","ialert isuccess svelte-1w6258q")},m(t,r){l(t,e,r),s(e,n)},p(t,e){2&e&&h(n,t[1])},d(t){t&&c(e)}}}function M(t){let e,n,r=t[2].nourl+"";return{c(){e=a("div"),n=u(r),d(e,"class","ialert iinfo svelte-1w6258q")},m(t,r){l(t,e,r),s(e,n)},p(t,e){4&e&&r!==(r=t[2].nourl+"")&&h(n,r)},d(t){t&&c(e)}}}function A(t){let e,n,i,m,y,b,w,$,v,x,_,k,E,q,S,z,L,T=t[12].title+"",O=t[12].name+"";return{c(){e=a("li"),n=a("div"),i=u(T),m=a("br"),y=f(),b=a("small"),w=a("i"),$=u(O),x=f(),_=a("div"),k=a("img"),S=f(),d(b,"class","svelte-1w6258q"),d(n,"class","run rleft svelte-1w6258q"),d(n,"title",v=t[2].run),k.src!==(E="images/right.png")&&d(k,"src","images/right.png"),d(k,"alt","Options"),g(k,"width","16px"),g(k,"height","24px"),d(_,"class","run svelte-1w6258q"),d(_,"title",q=t[2].runsilently),g(_,"display","flex"),g(_,"align-items","center"),g(_,"flex","0 0 32px"),g(e,"display","flex"),g(e,"justify-content","space-between")},m(r,c){l(r,e,c),s(e,n),s(n,i),s(n,m),s(n,y),s(n,b),s(b,w),s(w,$),s(e,x),s(e,_),s(_,k),s(e,S),z||(L=[p(n,"click",(function(){o(t[5](t[12],!0))&&t[5](t[12],!0).apply(this,arguments)})),p(_,"click",(function(){o(t[5](t[12],!1))&&t[5](t[12],!1).apply(this,arguments)}))],z=!0)},p(e,r){t=e,16&r&&T!==(T=t[12].title+"")&&h(i,T),16&r&&O!==(O=t[12].name+"")&&h($,O),4&r&&v!==(v=t[2].run)&&d(n,"title",v),4&r&&q!==(q=t[2].runsilently)&&d(_,"title",q)},d(t){t&&c(e),z=!1,r(L)}}}function R(e){let n,r,o,i,m,y,b,w,$,v,x,_,k,E,q,S,z,L,T,O,R=e[2].settings+"",C=e[2].help+"",U=e[3]&&j(e),I=e[1]&&N(e),B=!e[0]&&M(e),J=e[4],W=[];for(let t=0;t<J.length;t+=1)W[t]=A(H(e,J,t));return{c(){U&&U.c(),n=f(),I&&I.c(),r=f(),B&&B.c(),o=f(),i=a("ul");for(let t=0;t<W.length;t+=1)W[t].c();m=f(),y=a("div"),b=a("div"),w=a("img"),x=u(R),_=f(),k=a("a"),E=a("img"),z=u(C),w.src!==($="images/settings.png")&&d(w,"src","images/settings.png"),d(w,"alt",v=e[2].settings),g(w,"height","1.5rem"),g(w,"margin-right","0.5rem"),d(w,"class","svelte-1w6258q"),d(b,"class","menu svelte-1w6258q"),E.src!==(q="images/question-circle.png")&&d(E,"src","images/question-circle.png"),d(E,"alt",S=e[2].help),g(E,"height","1.5rem"),g(E,"margin-right","0.5rem"),d(E,"class","svelte-1w6258q"),d(k,"class","menu svelte-1w6258q"),d(k,"href",L=e[2].helplink),d(k,"target","_blank"),d(y,"class","elist svelte-1w6258q")},m(t,e){U&&U.m(t,e),l(t,n,e),I&&I.m(t,e),l(t,r,e),B&&B.m(t,e),l(t,o,e),l(t,i,e);for(let t=0;t<W.length;t+=1)W[t].m(i,null);l(t,m,e),l(t,y,e),s(y,b),s(b,w),s(b,x),s(y,_),s(y,k),s(k,E),s(k,z),T||(O=p(b,"click",P),T=!0)},p(t,[e]){if(t[3]?U?U.p(t,e):(U=j(t),U.c(),U.m(n.parentNode,n)):U&&(U.d(1),U=null),t[1]?I?I.p(t,e):(I=N(t),I.c(),I.m(r.parentNode,r)):I&&(I.d(1),I=null),t[0]?B&&(B.d(1),B=null):B?B.p(t,e):(B=M(t),B.c(),B.m(o.parentNode,o)),52&e){let n;for(J=t[4],n=0;n<J.length;n+=1){const r=H(t,J,n);W[n]?W[n].p(r,e):(W[n]=A(r),W[n].c(),W[n].m(i,null))}for(;n<W.length;n+=1)W[n].d(1);W.length=J.length}4&e&&v!==(v=t[2].settings)&&d(w,"alt",v),4&e&&R!==(R=t[2].settings+"")&&h(x,R),4&e&&S!==(S=t[2].help)&&d(E,"alt",S),4&e&&C!==(C=t[2].help+"")&&h(z,C),4&e&&L!==(L=t[2].helplink)&&d(k,"href",L)},i:t,o:t,d(t){U&&U.d(t),t&&c(n),I&&I.d(t),t&&c(r),B&&B.d(t),t&&c(o),t&&c(i),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(W,t),t&&c(m),t&&c(y),T=!1,O()}}}function C(){var t=document.documentElement.outerHTML;return chrome.runtime.sendMessage({action:"getSource",source:t}),t}function P(){chrome.runtime.openOptionsPage()}function U(t,e,n){let r="",o="",i="",s="",l="",c="en",a={en:{errext:"Eonza is not available at <b>eonzaHost</b>. Try to <b><a href='eonzaHost'\n\t\t\t\tstyle='color:#fff;text-decoration:underline;' target='_blank'>open</a></b> it in the browser.",help:"Help",helplink:"https://www.eonza.org/docs/chrome-extension.html",nourl:"Specify Eonza URL in Settings",run:"Run and open the script in the browser",runok:"Script is successfully run",runsilently:"Run silently",save:"Save",settings:"Settings"},ru:{errext:"Eonza не доступна по адресу <b>eonzaHost</b>. Попробуйте <b><a href='eonzaHost'\n\t\t\t\tstyle='color:#fff;text-decoration:underline;' target='_blank'>открыть</a></b> её в браузере.",help:"Помощь",helplink:"https://www.eonza.org/ru/docs/chrome-extension.html",nourl:"Укажите Eonza URL в Настройках",run:"Запустить и открыть скрипт в браузере",runok:"Скрипт успешно запущен",runsilently:"Запустить скрытно",save:"Сохранить",settings:"Настройки"}},u=a.en,f="",p=[];return chrome.runtime.onMessage.addListener((function(t,e){if("getSource"==t.action)return t.source})),document.addEventListener("DOMContentLoaded",(async function(){c=(navigator.language||navigator.userLanguage).substr(0,2),"ru"==c&&n(2,u=a[c]);let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.scripting.executeScript({target:{tabId:t.id},function:C},(t=>{chrome.runtime.lastError||(s=t[0].result)})),i=t.url,l=t.title,chrome.storage.sync.get({eonzahost:""},(function(t){n(0,r=t.eonzahost),r&&("/"==r.charAt(r.length-1)&&n(0,r=r.substr(0,r.length-1)),async function(){try{const t=await fetch(`${r}/api/browserext`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:i})});let e=await t.json();n(4,p=e.list)}catch(t){n(3,f=u.errext.replaceAll("eonzaHost",encodeURI(r)))}}())}))})),[r,o,u,f,p,async function(t,e){n(3,f="");try{const c=await fetch(`${r}/api/browserrun`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,open:e,url:i,title:l,html:t.settings.html?s:""})});let a=await c.json();a.error?n(3,f=a.error):(n(1,o=u.runok),setTimeout((()=>n(1,o="")),1e3),!r.startsWith("http://localhost")&&e&&setTimeout((()=>{let t=new URL(r);t.port=a.port,window.open(t.toString(),"_blank")}),1500))}catch(t){n(3,f=t)}}]}return new class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),O(this,t,U,R,i,{})}}({target:document.getElementById("app")})}();
